<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles/style.css">
    <title>Chat V2</title>
</head>
<body>
    <section id="home">
        <div class="divs">
            <div  class="square">
                <h2 class="square-header">Chat V2.0</h2>
                <p id="log-err" class="square-header warns" style="color: red; text-align: center;">*User or Password incorrect!!</p>
                <div class="default-form" id="logForm">
                    <label class="label">Login</label>
                    <input class="input-default" type="text" name="lg" id="lg">
                    <label class="label">Password</label>
                    <input class="input-default" type="password" name="pw" id="pw">
                    <button class="input-default bg-outline-purple" onclick="reqLog()">Enter</button>
                </div>
                <div class="register">
                    <span>Do your account! </span>
                    <a href="javascript:regHome();">SingUp</a>
                </div>
            </div>
        </div>
        <div class="divs">
            <div class="square">
                <h2 class="square-header">Register</h2>
                <div class="">
                    <p id="log-reg-err" class="square-header warns" style="color: red; text-align: center;">*Login exist!!</p>
                    <p id="nick-err" class="square-header warns" style="color: red; text-align: center;">*Nick exist!!</p>
                    <p id="suc-reg" class="square-header warns" style="color: green; text-align: center;">*Success!!</p>
                    <p id="reg-err" class="square-header warns" style="color: red; text-align: center;">*Try again later!!</p>
                </div>
                <div class="default-form" id="regForm">
                    <label class="label">Login</label>
                    <input class="input-default" type="text" name="" id="nlg">
                    <label class="label">NickName</label>
                    <input class="input-default" type="text" name="" id="nnn">
                    <label class="label">Password</label>
                    <input class="input-default" type="password" name="" id="npw">
                    <button class="input-default bg-outline-purple" onClick="reqReg()">Submit</button>
                </div>
                <div class="register">
                    <span>Already have an account?</span>
                    <a href="javascript:logHome();">SingIn</a>
                </div>
            </div>
        </div>
    </section>
    <section id="popups">
        <div>
           
        </div>
    </section>
</body>
<script>
document.getElementById('logForm').addEventListener('keypress', function(e){
    if(e.which == 13){
        reqLog();
    }
},false);

document.getElementById('regForm').addEventListener('keypress', function(e){
    if(e.which == 13){
        reqReg();
    }
},false);


async function makeReq(path, obj){
    const response = await fetch(path, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(obj),
    });
    
    return await response.json();
}

async function reqLog(){
    let path = "/login";
    let log = document.getElementById('lg').value;
    let pass = document.getElementById('pw').value;
    let obj = {
        log,
        pass,
    }
    let res = await makeReq(path, obj);
    if (res.infoUser){
        window.location.href = res.path
    } else {
        document.getElementById('log-err').style.display = "block";
    }
}

async function reqReg(){
    let path = "/register";
    let log = document.getElementById('nlg').value;
    let pass = document.getElementById('npw').value;
    let nick = document.getElementById('nnn').value;
    if(validate(log) && validate(pass) && validate(nick)){
        let obj = {
            log,
            nick,
            pass,
        }
        let res = await makeReq(path, obj);
        regMessage(res);
    }
}

function regMessage(res){
    let nE = document.getElementById('nick-err');
    let lE= document.getElementById('log-reg-err');
    let suc = document.getElementById('suc-reg');
    let err = document.getElementById('reg-err');
    switch(res.id){
        case 1:
            nE.style.display = "block";
            lE.style.display = "none";
            err.style.display = "none";
            suc.style.display = "none";
            break;
        case 2:
            lE.style.display = "block";
            nE.style.display = "none";
            err.style.display = "none";
            suc.style.display = "none";
            break;
        case 3:
            suc.style.display = "block";
            lE.style.display = "none";
            nE.style.display = "none";
            err.style.display = "none";
            break;
        case null:
            err.style.display = "block";
            nE.style.display = "none";
            lE.style.display = "none";
            suc.style.display = "none";
            break;
    }
}

function validate(str){
    if(str == null || str == '' || str.includes(' ')){
        return false;
    }
    else {
        return true;
    }
}
</script>
<script type="text/javascript" src="/js/homeAnimation.js"></script>
</html>

<!-- <h1>teste</h1>
<a href="/chat"><button>chat</button></a> -->